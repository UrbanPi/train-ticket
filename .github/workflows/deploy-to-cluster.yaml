name: Deploy to SCCH Cluster

on:
  workflow_dispatch:
    inputs:
      deploy-args:
        required: false
        type: choice
        description: 'Deployment arguments'
        default: ''
        options:
          -
          - --independent-db
          - --with-monitoring
          - --with-tracing
          - --independent-db --with-tracing
          - --independent-db --with-monitoring
          - --with-tracing --with-monitoring
          - --all

jobs:
  deploy:
    runs-on: [ dependabot ]
    steps:
      - name: Checkout
        uses: actions/checkout@v3
      - name: Execute kubectl commands
        uses: HPC/hpc-scch-actions@main
        env:
          HPC_USERNAME: ${{ secrets.HPC_USERNAME }}
          HPC_PASSWORD: ${{ secrets.HPC_PASSWORD }}
          HPC_TENANT: ${{ secrets.HPC_TENANT }}
        with:
          args: |
            kubectl apply -f .
            kubectl get pods
      - run: ./hack/deploy/deploy.sh scch-sws "${{ inputs.deploy-args }}"

